<div class="main-content-container" style="padding-top: 40px;">
  
  <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h4 class="section-label" style="display: inline;">All Publishers</h4>
      <span class="section-label" style="color: #678; margin-left: 10px;">
        <%= @total_count %> Companies
      </span>
    </div>

    <div class="review-sort-options">
      <span class="sort-label">Sort by:</span>
      
      <%= link_to "Most Games", publishers_path(sort: 'games_desc'), 
          class: "sort-link #{@sort == 'games_desc' ? 'active' : ''}" %>
      
      <%= link_to "Highest Rated", publishers_path(sort: 'rating_desc'), 
          class: "sort-link #{@sort == 'rating_desc' ? 'active' : ''}" %>
          
      <%= link_to "Name", publishers_path(sort: 'name_asc'), 
          class: "sort-link #{@sort == 'name_asc' ? 'active' : ''}" %>
    </div>
  </div>

  <table class="simple-table hover-table">
    <thead>
      <tr>
        <th class="text-left">Name</th>
        <th class="text-left">Location</th>
        <th class="text-center">Games</th>
        <th class="text-center">Avg Rating</th>
      </tr>
    </thead>
    <tbody>
      <% @publishers.each do |pub| %>
        <tr onclick="window.location='<%= publisher_path(pub) %>'" style="cursor: pointer;">
          
          <td>
            <div style="font-weight: bold; color: #fff; font-size: 1rem;">
              <%= pub.name %>
            </div>
          </td>

          <td class="text-gray"><%= pub.country || "—" %></td>
          <td class="text-center text-white"><%= pub.games_count %></td>

          <td class="text-center">
            <% if pub.avg_rating %>
              <span style="color: #00e054; font-weight: bold;">
                <%= pub.avg_rating.to_f.round(1) %>
              </span>
            <% else %>
              <span class="text-gray">—</span>
            <% end %>
          </td>

        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="pagination-controls">
    
    <% if @page > 1 %>
      <%= link_to "←", publishers_path(page: @page - 1, sort: @sort), class: "pagination-btn" %>
    <% else %>
      <span class="pagination-btn disabled">←</span>
    <% end %>

    <div class="pagination-numbers">
      <% 
         # SLIDING WINDOW LOGIC
         # Show 2 pages before and 2 pages after current page
         start_p = [@page - 2, 1].max
         end_p   = [@page + 2, @total_pages].min
      %>

      <% if start_p > 1 %>
        <%= link_to "1", publishers_path(page: 1, sort: @sort), class: "page-number" %>
        <% if start_p > 2 %>
          <span class="page-dots">...</span>
        <% end %>
      <% end %>

      <% (start_p..end_p).each do |p| %>
        <%= link_to p, publishers_path(page: p, sort: @sort), 
            class: "page-number #{'active' if p == @page}" %>
      <% end %>

      <% if end_p < @total_pages %>
        <% if end_p < @total_pages - 1 %>
          <span class="page-dots">...</span>
        <% end %>
        <%= link_to @total_pages, publishers_path(page: @total_pages, sort: @sort), class: "page-number" %>
      <% end %>
    </div>

    <% if @more_exists %>
      <%= link_to "→", publishers_path(page: @page + 1, sort: @sort), class: "pagination-btn" %>
    <% else %>
      <span class="pagination-btn disabled">→</span>
    <% end %>

  </div>
</div>
