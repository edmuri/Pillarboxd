<div class="developer-header">
  <div class="header-content">
    <h1 class="dev-name"><%= @developer.name %></h1>
    
    <% if @developer.country.present? %>
      <div class="dev-location">üìç <%= @developer.country %></div>
    <% end %>

    <% if @developer.website.present? %>
      <div class="dev-website">
        <%= link_to @developer.website, target: "_blank", rel: "noopener noreferrer", class: "website-link" do %>
          üîó Official Website
        <% end %>
      </div>
    <% end %>

    <div class="dev-stats">
      <div class="stat-item">
        <span class="stat-number"><%= @games_count %></span>
        <span class="stat-label">Games</span>
      </div>
      
      <div class="stat-item">
        <span class="stat-number"><%= (@avg_rating || 0).to_f.round(1) %></span>
        <span class="stat-label">Avg Rating</span>
      </div>
    </div>
  </div>
</div>

<div class="main-content-container">

  <% if @top_games.any? %>
    <h4 class="section-label">Highest Rated Projects</h4>
    <div class="poster-row">
      <% @top_games.each do |game| %>
        <%= link_to game_path(game), class: "poster-card", title: game.title do %>
          <div class="poster-image-wrapper">
            <img src="<%= game.cover_url.gsub('t_thumb', 't_cover_big') %>" loading="lazy">
            <% if (rating = game.reviews.average(:rating)) %>
              <div class="poster-rating">‚òÖ <%= rating.to_f.round(1) %></div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <%= turbo_frame_tag "games_catalog" do %>

    <div class="reviews-header-row" style="margin-top: 40px; margin-bottom: 15px;">
      <h4 class="section-label" style="margin: 0;">Complete Ludography</h4>
      
      <div class="review-sort-options">
        <span class="sort-label">Sort by:</span>
        
        <%= link_to "Newest", developer_path(@developer, sort: 'newest'), 
            class: "sort-link #{@sort == 'newest' ? 'active' : ''}" %>

        <%= link_to "Oldest", developer_path(@developer, sort: 'oldest'), 
            class: "sort-link #{@sort == 'oldest' ? 'active' : ''}" %>
        
        <%= link_to "Highest Rated", developer_path(@developer, sort: 'rating_desc'), 
            class: "sort-link #{@sort == 'rating_desc' ? 'active' : ''}" %>

        <%= link_to "Name", developer_path(@developer, sort: 'name_asc'), 
            class: "sort-link #{@sort == 'name_asc' ? 'active' : ''}" %>
      </div>
    </div>
    
    <table class="simple-table">
      <thead>
        <tr>
          <th class="text-left">Year</th>
          <th class="text-left">Title</th>
          <th class="text-center">Avg Rating</th> <th class="text-right">Reviews</th>
        </tr>
      </thead>
      <tbody>
        <% @games.each do |game| %>
          <tr>
            <td class="text-gray"><%= game.release_date&.year || "TBA" %></td>
            
            <td>
              <%= link_to game.title, game_path(game), 
                  class: "table-link", 
                  data: { turbo_frame: "_top" } %>
            </td>

            <td class="text-center">
              <% if game.computed_rating && game.computed_rating > 0 %>
                <span style="color: #00e054; font-weight: bold;">
                  <%= game.computed_rating.to_f.round(1) %>
                </span>
              <% else %>
                <span class="text-gray">‚Äî</span>
              <% end %>
            </td>

            <td class="text-right text-gray"><%= game.reviews.size %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="pagination-controls">
      
      <% if @page > 1 %>
        <%= link_to "‚Üê", developer_path(@developer, page: @page - 1, sort: @sort), class: "pagination-btn" %>
      <% else %>
        <span class="pagination-btn disabled">‚Üê</span>
      <% end %>

      <div class="pagination-numbers">
        <% 
           start_p = [@page - 2, 1].max
           end_p   = [@page + 2, @total_pages].min
        %>

        <% if start_p > 1 %>
          <%= link_to "1", developer_path(@developer, page: 1, sort: @sort), class: "page-number" %>
          <% if start_p > 2 %>
            <span class="page-dots">...</span>
          <% end %>
        <% end %>

        <% (start_p..end_p).each do |p| %>
          <%= link_to p, developer_path(@developer, page: p, sort: @sort), 
              class: "page-number #{'active' if p == @page}" %>
        <% end %>

        <% if end_p < @total_pages %>
          <% if end_p < @total_pages - 1 %>
            <span class="page-dots">...</span>
          <% end %>
          <%= link_to @total_pages, developer_path(@developer, page: @total_pages, sort: @sort), class: "page-number" %>
        <% end %>
      </div>

      <% if @more_exists %>
        <%= link_to "‚Üí", developer_path(@developer, page: @page + 1, sort: @sort), class: "pagination-btn" %>
      <% else %>
        <span class="pagination-btn disabled">‚Üí</span>
      <% end %>

    </div>

  <% end %> </div>

</div>
